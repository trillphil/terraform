#!/bin/bash

# download hashtopolis client from server
wget http://${hashtopolis_ip}/agents.php?download=2 -O hashtopolis.zip
unzip hashtopolis.zip

# create and populate initial config
tee config.json << YOLO
{
  "url": "http://${hashtopolis_ip}/api/server.php",
  "voucher": "${voucher_name}"
}
YOLO

# start the hashtopolis agent in the background
screen -S hashtopolis -d -m python3 __main__.py &

# force terraform to slow it's roll
sleep 5